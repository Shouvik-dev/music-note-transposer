<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Music Notes Transposer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      background: radial-gradient(circle at top, #4f46e5 0, #111827 40%, #020617 100%);
      color: #e5e7eb;
    }

    .card {
      width: 100%;
      max-width: 960px;
      background: rgba(15, 23, 42, 0.9);
      border-radius: 24px;
      padding: 24px 24px 28px;
      box-shadow:
        0 25px 50px -12px rgba(0, 0, 0, 0.75),
        0 0 0 1px rgba(148, 163, 184, 0.15);
      backdrop-filter: blur(16px);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      align-items: baseline;
      margin-bottom: 16px;
    }

    h1 {
      margin: 0;
      font-size: 1.6rem;
      letter-spacing: 0.03em;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    h1 span.logo {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      background: conic-gradient(from 180deg, #f97316, #e11d48, #6366f1, #22c55e, #f97316);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      color: #020617;
      font-weight: 700;
      box-shadow: 0 0 0 2px rgba(15, 23, 42, 0.9);
    }

    .subtitle {
      margin: 0;
      font-size: 0.85rem;
      color: #9ca3af;
    }

    .grid {
      display: grid;
      grid-template-columns: 1.2fr 1.2fr;
      gap: 20px;
      margin-top: 12px;
    }

    @media (max-width: 800px) {
      .grid {
        grid-template-columns: 1fr;
      }
      .card {
        padding: 18px;
      }
    }

    .panel {
      background: rgba(15, 23, 42, 0.9);
      border-radius: 18px;
      padding: 14px 14px 16px;
      border: 1px solid rgba(148, 163, 184, 0.25);
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .panel-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: #e5e7eb;
    }

    .badge {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(55, 65, 81, 0.85);
      color: #e5e7eb;
    }

    textarea {
      width: 100%;
      min-height: 200px;
      max-height: 340px;
      resize: vertical;
      border-radius: 14px;
      border: 1px solid rgba(75, 85, 99, 0.9);
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      padding: 10px 11px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.86rem;
      line-height: 1.4;
      outline: none;
      transition: border 0.15s, box-shadow 0.15s, background 0.15s;
    }

    textarea:focus {
      border-color: #6366f1;
      box-shadow: 0 0 0 1px rgba(99, 102, 241, 0.7);
      background: rgba(15, 23, 42, 1);
    }

    textarea[readonly] {
      opacity: 0.9;
    }

    .controls-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin-top: 6px;
      margin-bottom: 8px;
    }

    .number-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 0.8rem;
    }

    .number-input-wrap {
      display: flex;
      align-items: center;
      gap: 6px;
      background: rgba(15, 23, 42, 0.9);
      border-radius: 999px;
      padding: 4px 7px 4px 8px;
      border: 1px solid rgba(75, 85, 99, 0.9);
    }

    .number-input-wrap span {
      font-size: 0.8rem;
      color: #9ca3af;
    }

    input[type="number"] {
      width: 70px;
      border: none;
      outline: none;
      background: transparent;
      color: #e5e7eb;
      font-size: 0.9rem;
      text-align: center;
    }

    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      margin: 0;
    }

    .hint {
      font-size: 0.75rem;
      color: #9ca3af;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    button {
      border-radius: 999px;
      border: none;
      padding: 7px 13px;
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(37, 99, 235, 0.92);
      color: #e5e7eb;
      box-shadow: 0 10px 20px -8px rgba(37, 99, 235, 0.7);
      transition: transform 0.12s, box-shadow 0.12s, background 0.12s, opacity 0.12s;
      white-space: nowrap;
    }

    button.secondary {
      background: rgba(31, 41, 55, 0.95);
      box-shadow: 0 6px 14px -8px rgba(15, 23, 42, 0.9);
    }

    button.outline {
      background: transparent;
      border: 1px solid rgba(75, 85, 99, 0.9);
      box-shadow: none;
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
    }

    button:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 16px 30px -12px rgba(37, 99, 235, 0.8);
    }

    button.secondary:hover:not(:disabled) {
      box-shadow: 0 10px 20px -12px rgba(15, 23, 42, 0.9);
    }

    button.outline:hover:not(:disabled) {
      border-color: rgba(148, 163, 184, 1);
      background: rgba(15, 23, 42, 0.9);
    }

    button span.icon {
      font-size: 0.95em;
    }

    .status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
      font-size: 0.75rem;
      color: #9ca3af;
      gap: 10px;
      flex-wrap: wrap;
    }

    .status-badge {
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(15, 118, 110, 0.2);
      color: #99f6e4;
      font-size: 0.72rem;
    }

    .status-error {
      color: #fecaca;
    }

    .file-name {
      font-size: 0.75rem;
      color: #9ca3af;
    }

    .footer {
      margin-top: 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.72rem;
      color: #6b7280;
      gap: 10px;
      flex-wrap: wrap;
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .chip {
      border-radius: 999px;
      padding: 2px 8px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(15, 23, 42, 0.9);
    }

    .chip strong {
      color: #e5e7eb;
      font-weight: 500;
    }

    .hidden-input {
      display: none;
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="card-header">
      <div>
        <h1>
          <span class="logo">‚ô¨</span>
          Music Notes Transposer
        </h1>
        <p class="subtitle">
          Paste or upload your note file, choose transpose steps, and download the transposed version.
        </p>
      </div>
      <div class="badge">Preserves spaces ‚Ä¢ Invalid ‚Üí ‚Äú*‚Äù</div>
    </div>

    <div class="controls-row">
      <div class="number-group">
        <span>Transpose steps (semitones)</span>
        <div class="number-input-wrap">
          <span>-12</span>
          <input type="number" id="transposeValue" min="-12" max="12" value="0" />
          <span>+12</span>
        </div>
      </div>
      <div class="hint">
        Positive = up, negative = down. Allowed range: -12 to +12.
      </div>
    </div>

    <div class="grid">
      <!-- LEFT: INPUT -->
      <div class="panel">
        <div class="panel-header">
          <div class="panel-title">Input notes</div>
          <span class="badge">Text / .txt file</span>
        </div>

        <textarea id="inputArea" placeholder="Example:
C D#   F# A# Q  C++
C.C#.D.D#.E.F.F#.G.G#.A.A#.B.
..."></textarea>

        <div class="btn-row" style="margin-top: 10px;">
          <button id="transposeTextBtn">
            <span class="icon">üéµ</span>
            Transpose Text
          </button>

          <button id="loadFileBtn" class="secondary">
            <span class="icon">üìÇ</span>
            Load .txt File
          </button>

          <input type="file" id="fileInput" class="hidden-input" accept=".txt" />
        </div>

        <div class="status-bar">
          <span id="fileName" class="file-name">No file loaded</span>
          <span id="inputStatus" class="hint"></span>
        </div>
      </div>

      <!-- RIGHT: OUTPUT -->
      <div class="panel">
        <div class="panel-header">
          <div class="panel-title">Transposed output</div>
          <span class="badge">Download / copy</span>
        </div>

        <textarea id="outputArea" readonly placeholder="Transposed notes will appear here..."></textarea>

        <div class="btn-row" style="margin-top: 10px;">
          <button id="downloadBtn" disabled>
            <span class="icon">üíæ</span>
            Download as .txt
          </button>
          <button id="copyBtn" class="outline" disabled>
            <span class="icon">üìã</span>
            Copy Output
          </button>
        </div>

        <div class="status-bar">
          <span id="outputStatus" class="status-badge" style="display:none;"></span>
          <span id="errorStatus" class="status-error"></span>
        </div>
      </div>
    </div>

    <div class="footer">
      <div class="chip-row">
        <div class="chip"><strong>Notes:</strong> C, C#, D, ‚Ä¶ B with ., +, ++</div>
        <div class="chip"><strong>Spaces preserved</strong></div>
        <div class="chip"><strong>Invalid ‚Üí</strong> *</div>
      </div>
    </div>
  </div>

  <script>
    // --- NOTE TABLE (same as your Java array) ---
    const NOTES = [
      "C..", "C#..", "D..", "D#..", "E..", "F..", "F#..", "G..", "G#..", "A..", "A#..", "B..",
      "C.", "C#.", "D.", "D#.", "E.", "F.", "F#.", "G.", "G#.", "A.", "A#.", "B.",
      "C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B",
      "C+", "C#+", "D+", "D#+", "E+", "F+", "F#+", "G+", "G#+", "A+", "A#+", "B+",
      "C++", "C#++", "D++", "D#++", "E++", "F++", "F#++", "G++", "G#++", "A++", "A#++", "B++"
    ];

    // Fast lookup: note -> index
    const NOTE_INDEX = {};
    NOTES.forEach((note, idx) => {
      NOTE_INDEX[note] = idx;
    });

    // Regex:
    // - [A-G]#?[.+]*  : a valid note (letter A‚ÄìG, optional #, then 0+ of . or +)
    // -  +            : runs of spaces (preserved)
    // - .             : any other single character (treated as invalid -> "*")
    const TOKEN_REGEX = /[A-G]#?[.+]*| +|./g;

    const transposeInput = document.getElementById("transposeValue");
    const inputArea = document.getElementById("inputArea");
    const outputArea = document.getElementById("outputArea");
    const transposeTextBtn = document.getElementById("transposeTextBtn");
    const loadFileBtn = document.getElementById("loadFileBtn");
    const fileInput = document.getElementById("fileInput");
    const downloadBtn = document.getElementById("downloadBtn");
    const copyBtn = document.getElementById("copyBtn");

    const fileNameLabel = document.getElementById("fileName");
    const inputStatus = document.getElementById("inputStatus");
    const outputStatus = document.getElementById("outputStatus");
    const errorStatus = document.getElementById("errorStatus");

    let lastContent = "";   // last transposed content (for download)
    let lastFileName = "";  // original file name

    function validateTransposeValue() {
      const raw = transposeInput.value.trim();
      const value = Number(raw);
      if (!Number.isFinite(value) || raw === "") {
        errorStatus.textContent = "Transpose value must be a number between -12 and +12.";
        return null;
      }
      if (value < -12 || value > 12) {
        errorStatus.textContent = "Transpose value must be between -12 and +12.";
        return null;
      }
      errorStatus.textContent = "";
      return value;
    }

    function transposeLine(line, steps) {
      // Process one line, preserving its length via tokens (notes, spaces, others)
      const tokens = line.match(TOKEN_REGEX);
      if (!tokens) return "";

      let result = "";

      for (const token of tokens) {
        // Spaces -> keep exactly
        if (token.trim() === "") {
          result += token;
          continue;
        }

        const idx = NOTE_INDEX[token];

        // If not a valid note, mark as "*"
        if (idx === undefined) {
          result += "*";
          continue;
        }

        // Transpose with wrap-around
        let newIndex = idx + steps;
        const len = NOTES.length;
        newIndex = ((newIndex % len) + len) % len; // proper modulo for negatives

        result += NOTES[newIndex];
      }

      return result;
    }

    function transposeContent(content, steps) {
      const lines = content.split(/\r?\n/);
      const outLines = lines.map(line => transposeLine(line, steps));
      return outLines.join("\n");
    }

    function doTransposeFromTextArea() {
      const steps = validateTransposeValue();
      if (steps === null) return;

      const content = inputArea.value;
      if (!content) {
        errorStatus.textContent = "Please enter some notes or load a file first.";
        return;
      }

      const transposed = transposeContent(content, steps);
      outputArea.value = transposed;
      lastContent = transposed;
      outputStatus.style.display = "inline-flex";
      outputStatus.textContent = "Transposed from text input";
      errorStatus.textContent = "";

      downloadBtn.disabled = !transposed;
      copyBtn.disabled = !transposed;
    }

    function handleFileSelected(file) {
      if (!file) return;
      fileNameLabel.textContent = "Loaded: " + file.name;
      lastFileName = file.name;
      inputStatus.textContent = "Reading file...";

      const reader = new FileReader();
      reader.onload = function (e) {
        const text = e.target.result;
        inputArea.value = text;
        inputStatus.textContent = "File loaded into input area. Click ‚ÄúTranspose Text‚Äù.";
      };
      reader.onerror = function () {
        inputStatus.textContent = "Error reading file.";
      };
      reader.readAsText(file);
    }

    function downloadOutput() {
      if (!lastContent) return;

      const blob = new Blob([lastContent], { type: "text/plain;charset=utf-8" });

      // derive output filename
      let baseName = "output_transposed";
      if (lastFileName) {
        const dot = lastFileName.lastIndexOf(".");
        baseName = dot > 0 ? lastFileName.slice(0, dot) + "_transposed" : lastFileName + "_transposed";
      }

      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = baseName + ".txt";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

      outputStatus.style.display = "inline-flex";
      outputStatus.textContent = "Output downloaded";
    }

    function copyOutputToClipboard() {
      if (!outputArea.value) return;
      navigator.clipboard.writeText(outputArea.value).then(
        () => {
          outputStatus.style.display = "inline-flex";
          outputStatus.textContent = "Output copied to clipboard";
        },
        () => {
          errorStatus.textContent = "Failed to copy to clipboard.";
        }
      );
    }

    // --- Event bindings ---
    transposeTextBtn.addEventListener("click", doTransposeFromTextArea);

    loadFileBtn.addEventListener("click", () => {
      fileInput.click();
    });

    fileInput.addEventListener("change", (e) => {
      const file = e.target.files[0];
      handleFileSelected(file);
    });

    downloadBtn.addEventListener("click", downloadOutput);
    copyBtn.addEventListener("click", copyOutputToClipboard);

    transposeInput.addEventListener("change", validateTransposeValue);
    transposeInput.addEventListener("blur", validateTransposeValue);
    transposeInput.addEventListener("input", () => {
      errorStatus.textContent = "";
    });

    // Enable / disable copy & download based on output changes
    const observer = new MutationObserver(() => {
      const hasOutput = !!outputArea.value;
      downloadBtn.disabled = !hasOutput;
      copyBtn.disabled = !hasOutput;
    });
    observer.observe(outputArea, { attributes: true, childList: true, subtree: true });

  </script>
</body>
</html>
